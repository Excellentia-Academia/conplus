<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur de Re√ßus - Concours d'√âloquence</title>
    
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        /* === STYLES DE BASE (inchang√©s) === */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(to right, #2c3e50, #34495e); color: white; padding: 30px; text-align: center; }
        .main-content { padding: 40px; display: grid; grid-template-columns: 2fr 1fr; gap: 30px; }
        @media (max-width: 992px) { .main-content { grid-template-columns: 1fr; } }
        .form-section { background: #f8f9fa; padding: 30px; border-radius: 10px; border: 2px solid #e9ecef; }
        .code-input { width: 100%; padding: 20px; border: 2px solid #ddd; border-radius: 10px; font-family: 'Courier New', monospace; font-size: 16px; resize: vertical; min-height: 200px; margin-bottom: 15px; }
        .button-group { display: flex; gap: 15px; flex-wrap: wrap; margin-top: 30px; }
        .btn { padding: 15px 30px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 10px; }
        .btn-primary { background: linear-gradient(135deg, #3498db, #2980b9); color: white; }
        .download-section { margin-top: 40px; padding: 30px; background: linear-gradient(135deg, #d4edda, #c3e6cb); border-radius: 15px; display: none; }
        .loader { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); z-index: 1000; align-items: center; justify-content: center; }
        .notification { position: fixed; top: 20px; right: 20px; padding: 15px 25px; background: white; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); z-index: 1001; }
    </style>
</head>
<body>
    <div class="container">
        <!-- En-t√™te -->
        <div class="header">
            <h1>üé§ G√©n√©rateur de Re√ßus de Paiement</h1>
            <p>Concours d'√âloquence 2024 ‚Ä¢ 10 re√ßus par page A4</p>
        </div>

        <!-- Contenu principal -->
        <div class="main-content">
            <!-- Colonne gauche -->
            <div>
                <!-- Formulaire -->
                <div class="form-section">
                    <div style="margin-bottom: 25px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #2c3e50; font-size: 18px;">
                            üìù Codes de vote (un par ligne)
                        </label>
                        <textarea 
                            id="codeInput" 
                            class="code-input" 
                            placeholder="Entrez les codes, un par ligne :&#10;ELOQ-2024-001&#10;ELOQ-2024-002&#10;ELOQ-2024-003&#10;..."
                            rows="8"
                        >ELOQ-2024-001
ELOQ-2024-002
ELOQ-2024-003
ELOQ-2024-004
ELOQ-2024-005
ELOQ-2024-006
ELOQ-2024-007
ELOQ-2024-008
ELOQ-2024-009
ELOQ-2024-010</textarea>
                        <div style="text-align: right; font-size: 14px; color: #7f8c8d;">
                            <span id="codeCount">10</span> codes saisis
                        </div>
                    </div>

                    <!-- Options -->
                    <div style="margin-bottom: 25px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #2c3e50; font-size: 18px;">
                            ‚öôÔ∏è Options de g√©n√©ration
                        </label>
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <input type="checkbox" id="optionWatermark" checked style="width: 20px; height: 20px;">
                            <label for="optionWatermark" style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <div style="width: 20px; height: 20px; background: #3498db; opacity: 0.3;"></div>
                                Filigrane (IMG_1812.jpeg)
                            </label>
                        </div>
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <input type="checkbox" id="optionSeal" style="width: 20px; height: 20px;">
                            <label for="optionSeal" style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <div style="width: 20px; height: 20px; border: 2px solid #000; border-radius: 50%;"></div>
                                Sceau officiel (Times_New_Roman.png)
                            </label>
                        </div>
                    </div>

                    <!-- Boutons -->
                    <div class="button-group">
                        <button class="btn btn-primary" id="generateBtn">
                            üöÄ G√©n√©rer les Re√ßus PDF
                        </button>
                        <button class="btn" style="background: #95a5a6; color: white;" id="previewBtn">
                            üëÅÔ∏è Aper√ßu
                        </button>
                        <button class="btn" style="background: #95a5a6; color: white;" id="clearBtn">
                            üóëÔ∏è Effacer
                        </button>
                    </div>
                </div>

                <!-- Section t√©l√©chargement -->
                <div class="download-section" id="downloadSection">
                    <div style="display: flex; align-items: center; gap: 25px;">
                        <div style="font-size: 60px; color: #28a745;">‚úÖ</div>
                        <div style="flex: 1;">
                            <h3 style="color: #155724; margin-bottom: 10px; font-size: 24px;">
                                Re√ßus g√©n√©r√©s avec succ√®s !
                            </h3>
                            <p id="downloadMessage">10 re√ßus pr√™ts √† t√©l√©charger</p>
                            <div style="color: #0c5460; display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                                <span>üìÑ</span>
                                <span id="fileName">recus_eloquence.pdf</span>
                                ‚Ä¢
                                <span id="fileSize">~250 KB</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 15px;">
                            <button class="btn btn-primary" id="downloadPDFBtn">
                                üì• T√©l√©charger PDF
                            </button>
                            <button class="btn" style="background: #95a5a6; color: white;" id="printBtn">
                                üñ®Ô∏è Imprimer
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Colonne droite -->
            <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                <h3 style="margin-bottom: 20px; color: #2c3e50;">üé® Options de Couleur</h3>
                
                <!-- Choix de couleurs -->
                <div style="margin-bottom: 25px;">
                    <p style="color: #666; margin-bottom: 15px;">
                        Personnalisez les couleurs des re√ßus :
                    </p>
                    <div style="border: 2px solid #e9ecef; border-radius: 10px; padding: 20px; background: #f8f9fa;">
                        <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-size: 14px; color: #2c3e50;">Couleur Rouge</label>
                                <input type="color" id="colorRed" value="#e74c3c" style="width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 5px; cursor: pointer;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-size: 14px; color: #2c3e50;">Couleur Bleu</label>
                                <input type="color" id="colorBlue" value="#3498db" style="width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 5px; cursor: pointer;">
                            </div>
                        </div>
                        <button id="applyColorsBtn" style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%;">
                            üé® Appliquer les couleurs aux re√ßus
                        </button>
                    </div>
                </div>

                <!-- Aper√ßu des couleurs -->
                <div style="margin-bottom: 25px;">
                    <p style="color: #2c3e50; margin-bottom: 10px; font-weight: 600;">
                        Aper√ßu des couleurs :
                    </p>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <div style="flex: 1; height: 20px; background: #e74c3c; border-radius: 3px;" id="previewRed"></div>
                        <div style="flex: 1; height: 20px; background: #3498db; border-radius: 3px;" id="previewBlue"></div>
                    </div>
                    <p style="font-size: 12px; color: #666; text-align: center;">
                        Rouge: Titres ‚Ä¢ Bleu: Encadrements
                    </p>
                </div>

                <!-- Informations -->
                <div id="colorInfo" style="background: #d1ecf1; padding: 15px; border-radius: 5px; border-left: 4px solid #17a2b8;">
                    <p style="color: #0c5460; margin: 0; font-size: 14px;">
                        <strong>üí° Asthe :</strong> Les couleurs rouge et bleu seront appliqu√©es automatiquement aux re√ßus
                    </p>
                </div>
            </div>
        </div>

        <!-- Pied de page -->
        <div style="background: #2c3e50; color: white; padding: 30px; text-align: center; margin-top: 40px;">
            <p>¬© 2024 Concours d'√âloquence ‚Ä¢ Tous droits r√©serv√©s</p>
            <p style="margin-top: 10px; opacity: 0.8; font-size: 14px;">
                G√©n√©rateur officiel de re√ßus ‚Ä¢ Version 3.2 ‚Ä¢ Couleurs personnalisables
            </p>
        </div>
    </div>

    <!-- Loader -->
    <div class="loader" id="loader">
        <div style="text-align: center; max-width: 400px; padding: 40px; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div style="width: 80px; height: 80px; margin: 0 auto 30px; border: 5px solid #f3f3f3; border-top: 5px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite;"></div>
            <h3>G√©n√©ration en cours...</h3>
            <p id="loaderStatus">Pr√©paration des re√ßus</p>
            <div style="height: 8px; background: #eee; border-radius: 4px; margin: 30px 0; overflow: hidden;">
                <div id="progressBar" style="height: 100%; background: linear-gradient(to right, #3498db, #9b59b6); width: 0%; transition: width 0.3s ease; border-radius: 4px;"></div>
            </div>
        </div>
    </div>

    <script>
        // ============ VARIABLES GLOBALES ============
        let codes = [];
        let generatedPDF = null;
        let selectedRedColor = '#e74c3c';
        let selectedBlueColor = '#3498db';

        // ============ INITIALISATION ============
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initialisation du g√©n√©rateur');
            
            updateCodeCount();
            setupColorPickers();
            
            // √âv√©nements
            document.getElementById('codeInput').addEventListener('input', updateCodeCount);
            document.getElementById('generateBtn').addEventListener('click', generatePDFWithColors);
            document.getElementById('previewBtn').addEventListener('click', showPreview);
            document.getElementById('clearBtn').addEventListener('click', clearAll);
            document.getElementById('downloadPDFBtn').addEventListener('click', downloadPDF);
            document.getElementById('printBtn').addEventListener('click', printPDF);
            document.getElementById('applyColorsBtn').addEventListener('click', applyColors);
        });

        // ============ GESTION DES COULEURS ============
        function setupColorPickers() {
            const colorRed = document.getElementById('colorRed');
            const colorBlue = document.getElementById('colorBlue');
            const previewRed = document.getElementById('previewRed');
            const previewBlue = document.getElementById('previewBlue');
            
            // Initialiser les aper√ßus
            previewRed.style.background = selectedRedColor;
            previewBlue.style.background = selectedBlueColor;
            
            // √âcouter les changements
            colorRed.addEventListener('input', function() {
                selectedRedColor = this.value;
                previewRed.style.background = selectedRedColor;
            });
            
            colorBlue.addEventListener('input', function() {
                selectedBlueColor = this.value;
                previewBlue.style.background = selectedBlueColor;
            });
        }

        function applyColors() {
            showNotification('üé® Couleurs appliqu√©es avec succ√®s !', 'success');
            
            // Mettre √† jour l'info
            document.getElementById('colorInfo').innerHTML = `
                <p style="color: #155724; margin: 0; font-size: 14px;">
                    <strong>‚úÖ Couleurs enregistr√©es :</strong> Elles seront utilis√©es pour la prochaine g√©n√©ration
                </p>
            `;
        }

        // ============ G√âN√âRATION PDF ============
        async function generatePDFWithColors() {
            if (codes.length === 0) {
                showNotification('‚ùå Veuillez entrer au moins un code', 'error');
                return;
            }

            showLoader('Cr√©ation des re√ßus color√©s...');
            
            try {
                // Options
                const useWatermark = document.getElementById('optionWatermark').checked;
                const useSeal = document.getElementById('optionSeal').checked;
                
                // Cr√©er le PDF
                const pdf = await createReceiptsPDF(codes, useWatermark, useSeal);
                generatedPDF = pdf;
                
                // Mettre √† jour l'interface
                updateDownloadSection();
                document.getElementById('downloadSection').style.display = 'block';
                
                hideLoader();
                showNotification(`‚úÖ ${codes.length} re√ßu(s) g√©n√©r√©(s) avec couleurs`, 'success');
                
            } catch (error) {
                console.error('Erreur:', error);
                hideLoader();
                showNotification('‚ùå Erreur g√©n√©ration PDF: ' + error.message, 'error');
            }
        }

        // Cr√©er les re√ßus PDF avec couleurs
        async function createReceiptsPDF(codes, useWatermark, useSeal) {
            return new Promise((resolve, reject) => {
                try {
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF({
                        orientation: 'portrait',
                        unit: 'mm',
                        format: 'a4'
                    });

                    const pageWidth = 210;
                    const pageHeight = 297;
                    const margin = 20;
                    const receiptWidth = 85;
                    const receiptHeight = 45;
                    const cols = 2;
                    const rows = 5;
                    const horizontalGap = (pageWidth - 2 * margin - cols * receiptWidth) / (cols - 1);
                    const verticalGap = (pageHeight - 2 * margin - rows * receiptHeight) / (rows - 1);

                    let receiptIndex = 0;

                    // G√©n√©rer page par page
                    for (let page = 0; page < Math.ceil(codes.length / 10); page++) {
                        if (page > 0) {
                            pdf.addPage();
                        }

                        pdf.setFont('helvetica');
                        pdf.setFontSize(8);

                        // 10 re√ßus par page
                        for (let row = 0; row < rows; row++) {
                            for (let col = 0; col < cols; col++) {
                                if (receiptIndex >= codes.length) break;

                                const x = margin + col * (receiptWidth + horizontalGap);
                                const y = margin + row * (receiptHeight + verticalGap);
                                const code = codes[receiptIndex];
                                
                                // === ENCADREMENT AVEC COULEUR BLEUE ===
                                pdf.setDrawColor(52, 152, 219); // Bleu par d√©faut
                                if (selectedBlueColor) {
                                    const blueRGB = hexToRgb(selectedBlueColor);
                                    if (blueRGB) {
                                        pdf.setDrawColor(blueRGB.r, blueRGB.g, blueRGB.b);
                                    }
                                }
                                pdf.setLineWidth(0.8); // Ligne plus √©paisse pour l'encadrement
                                pdf.rect(x, y, receiptWidth, receiptHeight);
                                
                                // Ligne de s√©paration int√©rieure avec couleur
                                pdf.setDrawColor(200, 200, 200); // Gris clair
                                pdf.setLineWidth(0.3);
                                pdf.line(x + 3, y + 10, x + receiptWidth - 3, y + 10);

                                // Filigrane (optionnel)
                                if (useWatermark) {
                                    pdf.setTextColor(220, 220, 220); // Gris tr√®s clair
                                    pdf.setFontSize(35);
                                    pdf.text('√âLOQUENCE', x + receiptWidth/2, y + receiptHeight/2, { 
                                        align: 'center', 
                                        angle: 45 
                                    });
                                    pdf.setTextColor(0, 0, 0);
                                    pdf.setFontSize(8);
                                }

                                // === EN-T√äTE AVEC COULEUR ROUGE ===
                                pdf.setFontSize(11);
                                pdf.setFont('helvetica', 'bold');
                                
                                // Titre en rouge
                                pdf.setTextColor(231, 76, 60); // Rouge par d√©faut
                                if (selectedRedColor) {
                                    const redRGB = hexToRgb(selectedRedColor);
                                    if (redRGB) {
                                        pdf.setTextColor(redRGB.r, redRGB.g, redRGB.b);
                                    }
                                }
                                pdf.text('RE√áU DE PAIEMENT', x + receiptWidth/2, y + 5, { align: 'center' });
                                
                                // Sous-titre en noir
                                pdf.setTextColor(0, 0, 0);
                                pdf.setFont('helvetica', 'normal');
                                pdf.setFontSize(9);
                                pdf.text('Concours √âloquence en Sc√®ne', x + receiptWidth/2, y + 8.5, { align: 'center' });
                                pdf.setFontSize(8);

                                // === INFORMATIONS ===
                                const now = new Date();
                                const dateStr = '06 Mars 2026'; // Date fixe comme demand√©e
                                const ref = `REF-${now.getFullYear()}-${String(receiptIndex + 1).padStart(4, '0')}`;

                                pdf.text(`Date: ${dateStr}`, x + 5, y + 15);
                                pdf.text(`R√©f: ${ref}`, x + 5, y + 19);
                                
                                // Montant en rouge
                                pdf.setTextColor(231, 76, 60);
                                if (selectedRedColor) {
                                    const redRGB = hexToRgb(selectedRedColor);
                                    if (redRGB) {
                                        pdf.setTextColor(redRGB.r, redRGB.g, redRGB.b);
                                    }
                                }
                                pdf.setFont('helvetica', 'bold');
                                pdf.text('Montant: 1000fc', x + 5, y + 23);
                                pdf.setTextColor(0, 0, 0);
                                pdf.setFont('helvetica', 'normal');

                                // === CODE DE VOTE EN ROUGE ===
                                pdf.setFont('courier', 'bold');
                                pdf.setFontSize(10);
                                pdf.text('CODE DE VOTE:', x + receiptWidth/2, y + 29, { align: 'center' });
                                pdf.setFontSize(13);
                                
                                // Code en rouge
                                pdf.setTextColor(231, 76, 60);
                                if (selectedRedColor) {
                                    const redRGB = hexToRgb(selectedRedColor);
                                    if (redRGB) {
                                        pdf.setTextColor(redRGB.r, redRGB.g, redRGB.b);
                                    }
                                }
                                pdf.text(code, x + receiptWidth/2, y + 34, { align: 'center' });
                                pdf.setTextColor(0, 0, 0);
                                pdf.setFont('helvetica', 'normal');
                                pdf.setFontSize(8);

                                // === ZONE INFERIEURE AVEC ACCENTS DE COULEUR ===
                                // Ligne de s√©paration avec couleur bleue
                                pdf.setDrawColor(52, 152, 219);
                                if (selectedBlueColor) {
                                    const blueRGB = hexToRgb(selectedBlueColor);
                                    if (blueRGB) {
                                        pdf.setDrawColor(blueRGB.r, blueRGB.g, blueRGB.b);
                                    }
                                }
                                pdf.setLineWidth(0.5);
                                pdf.line(x + 10, y + receiptHeight - 8, x + receiptWidth - 10, y + receiptHeight - 8);
                                
                                // Texte "Valid√© par" avec couleur bleue
                                pdf.setFontSize(7);
                                pdf.setTextColor(52, 152, 219);
                                if (selectedBlueColor) {
                                    const blueRGB = hexToRgb(selectedBlueColor);
                                    if (blueRGB) {
                                        pdf.setTextColor(blueRGB.r, blueRGB.g, blueRGB.b);
                                    }
                                }
                                pdf.text('Valid√© par', x + receiptWidth/2, y + receiptHeight - 6, { align: 'center' });
                                
                                // Nom de l'organisation en rouge
                                pdf.setFont('helvetica', 'bold');
                                pdf.setTextColor(231, 76, 60);
                                if (selectedRedColor) {
                                    const redRGB = hexToRgb(selectedRedColor);
                                    if (redRGB) {
                                        pdf.setTextColor(redRGB.r, redRGB.g, redRGB.b);
                                    }
                                }
                                pdf.setFontSize(9);
                                pdf.text('Excellentia Academia', x + receiptWidth/2, y + receiptHeight - 2.5, { align: 'center' });
                                
                                // Retour aux param√®tres par d√©faut
                                pdf.setFont('helvetica', 'normal');
                                pdf.setTextColor(0, 0, 0);

                                // === ACCENTS DECORATIFS DE COULEUR ===
                                // Point d√©coratif rouge en haut √† gauche
                                pdf.setFillColor(231, 76, 60);
                                if (selectedRedColor) {
                                    const redRGB = hexToRgb(selectedRedColor);
                                    if (redRGB) {
                                        pdf.setFillColor(redRGB.r, redRGB.g, redRGB.b);
                                    }
                                }
                                pdf.circle(x + 3, y + 3, 1, 'F');
                                
                                // Point d√©coratif bleu en haut √† droite
                                pdf.setFillColor(52, 152, 219);
                                if (selectedBlueColor) {
                                    const blueRGB = hexToRgb(selectedBlueColor);
                                    if (blueRGB) {
                                        pdf.setFillColor(blueRGB.r, blueRGB.g, blueRGB.b);
                                    }
                                }
                                pdf.circle(x + receiptWidth - 3, y + 3, 1, 'F');

                                // Num√©ro de s√©quence en gris
                                pdf.setFontSize(6);
                                pdf.setTextColor(100, 100, 100);
                                pdf.text(`${receiptIndex + 1}/${codes.length}`, x + receiptWidth - 8, y + 4);
                                pdf.setTextColor(0, 0, 0);

                                receiptIndex++;
                                
                                // Mettre √† jour la progression
                                updateProgress(Math.min((receiptIndex / codes.length) * 100, 90));
                            }
                        }

                        // Num√©ro de page avec couleur bleue
                        pdf.setFontSize(10);
                        pdf.setTextColor(52, 152, 219);
                        if (selectedBlueColor) {
                            const blueRGB = hexToRgb(selectedBlueColor);
                            if (blueRGB) {
                                pdf.setTextColor(blueRGB.r, blueRGB.g, blueRGB.b);
                            }
                        }
                        pdf.text(`Page ${page + 1}`, pageWidth/2, pageHeight - 10, { align: 'center' });
                        pdf.setTextColor(0, 0, 0);
                    }

                    updateProgress(100);
                    resolve(pdf);

                } catch (error) {
                    reject(error);
                }
            });
        }

        // Fonction utilitaire pour convertir hex en RGB
        function hexToRgb(hex) {
            // Retirer le # si pr√©sent
            hex = hex.replace(/^#/, '');
            
            // Convertir 3-digit hex en 6-digit
            if (hex.length === 3) {
                hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];
            }
            
            // V√©rifier que c'est un hex valide
            if (hex.length !== 6) {
                return null;
            }
            
            // Convertir en RGB
            const r = parseInt(hex.substring(0, 2), 16);
            const g = parseInt(hex.substring(2, 4), 16);
            const b = parseInt(hex.substring(4, 6), 16);
            
            return { r, g, b };
        }

        // ============ FONCTIONS UTILITAIRES ============

        function updateCodeCount() {
            const text = document.getElementById('codeInput').value.trim();
            codes = text.split('\n')
                .map(code => code.trim())
                .filter(code => code.length > 0);
            document.getElementById('codeCount').textContent = codes.length;
        }

        function showPreview() {
            if (codes.length === 0) {
                showNotification('‚ùå Entrez d\'abord des codes', 'error');
                return;
            }
            
            const previewWindow = window.open('', '_blank', 'width=600,height=800');
            previewWindow.document.write(`
                <html>
                <head><title>Aper√ßu Re√ßu</title>
                <style>
                    .red-text { color: ${selectedRedColor}; }
                    .blue-border { border-color: ${selectedBlueColor}; }
                </style>
                </head>
                <body style="font-family: Arial; padding: 20px; background: #f5f5f5;">
                    <h1 style="text-align: center; color: #2c3e50;">üìã Aper√ßu du Re√ßu avec Couleurs</h1>
                    <div style="border: 2px solid ${selectedBlueColor}; padding: 25px; width: 300px; margin: 20px auto; background: white; position: relative; border-radius: 5px;">
                        
                        <!-- Points d√©coratifs -->
                        <div style="position: absolute; top: 10px; left: 10px; width: 8px; height: 8px; background: ${selectedRedColor}; border-radius: 50%;"></div>
                        <div style="position: absolute; top: 10px; right: 10px; width: 8px; height: 8px; background: ${selectedBlueColor}; border-radius: 50%;"></div>
                        
                        <!-- En-t√™te -->
                        <div style="text-align: center; margin-bottom: 20px;">
                            <h2 class="red-text" style="margin: 0 0 5px 0;">RE√áU DE PAIEMENT</h2>
                            <p style="color: #666; margin: 0;">Concours √âloquence en Sc√®ne</p>
                        </div>
                        
                        <!-- Ligne de s√©paration -->
                        <div style="border-top: 1px solid #ddd; margin: 0 0 15px 0;"></div>
                        
                        <!-- Informations -->
                        <div style="margin-bottom: 20px;">
                            <p><strong>Date:</strong> 06 Mars 2026</p>
                            <p><strong>Montant:</strong> <span class="red-text" style="font-weight: bold;">1000fc</span></p>
                        </div>
                        
                        <!-- Code de vote -->
                        <div style="text-align: center; margin: 25px 0; padding: 10px; background: #f9f9f9; border-radius: 5px;">
                            <p style="color: #666; margin: 0 0 5px 0;">CODE DE VOTE:</p>
                            <p class="red-text" style="font-size: 18px; font-weight: bold; margin: 0; font-family: 'Courier New';">${codes[0]}</p>
                        </div>
                        
                        <!-- Ligne de signature -->
                        <div style="border-top: 1px solid ${selectedBlueColor}; margin: 20px 0 10px 0; padding-top: 10px; text-align: center;">
                            <p style="color: ${selectedBlueColor}; font-size: 12px; margin: 0 0 5px 0; font-style: italic;">Valid√© par</p>
                            <p class="red-text" style="font-weight: bold; margin: 0;">Excellentia Academia</p>
                        </div>
                        
                    </div>
                    
                    <!-- Informations sur les couleurs -->
                    <div style="margin: 30px auto; width: 300px; padding: 15px; background: white; border-radius: 5px; border-left: 4px solid ${selectedBlueColor};">
                        <p style="margin: 0; color: #666; font-size: 14px;">
                            <strong>üé® Couleurs appliqu√©es :</strong><br>
                            <span style="color: ${selectedRedColor};">‚óè Rouge</span> : Titres, montant, code<br>
                            <span style="color: ${selectedBlueColor};">‚óè Bleu</span> : Bordures, s√©parations
                        </p>
                    </div>
                    
                    <p style="text-align: center; color: #666; margin-top: 20px;">
                        ‚úÖ Le PDF final contiendra ${codes.length} re√ßu(s) avec ces couleurs
                    </p>
                </body>
                </html>
            `);
        }

        function clearAll() {
            if (codes.length > 0 && confirm('Effacer tous les codes ?')) {
                document.getElementById('codeInput').value = '';
                codes = [];
                updateCodeCount();
                document.getElementById('downloadSection').style.display = 'none';
                showNotification('üóëÔ∏è Codes effac√©s', 'info');
            }
        }

        function downloadPDF() {
            if (!generatedPDF) {
                showNotification('‚ùå G√©n√©rer d\'abord les re√ßus', 'error');
                return;
            }
            
            const filename = `recus_eloquence_en_scene_${new Date().toISOString().slice(0,19).replace(/[:]/g, '-')}.pdf`;
            generatedPDF.save(filename);
            showNotification('üì• T√©l√©chargement d√©marr√©', 'success');
        }

        function printPDF() {
            if (!generatedPDF) {
                showNotification('‚ùå G√©n√©rer d\'abord les re√ßus', 'error');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            const pdfDataUri = generatedPDF.output('datauristring');
            printWindow.document.write(`
                <html><head><title>Impression</title></head>
                <body><iframe src="${pdfDataUri}" width="100%" height="100%" style="border: none;"></iframe>
                <script>setTimeout(() => window.print(), 1000);<\/script>
                </body></html>
            `);
        }

        function updateDownloadSection() {
            const pageCount = Math.ceil(codes.length / 10);
            document.getElementById('downloadMessage').textContent = 
                `${codes.length} re√ßu(s) ‚Ä¢ ${pageCount} page(s) A4 ‚Ä¢ Avec couleurs`;
            document.getElementById('fileName').textContent = 
                `recus_eloquence_${new Date().toISOString().slice(0,10)}.pdf`;
        }

        function showLoader(message) {
            document.getElementById('loaderStatus').textContent = message;
            document.getElementById('loader').style.display = 'flex';
            document.getElementById('progressBar').style.width = '0%';
        }

        function hideLoader() {
            document.getElementById('loader').style.display = 'none';
            document.getElementById('progressBar').style.width = '100%';
        }

        function updateProgress(percent) {
            document.getElementById('progressBar').style.width = `${percent}%`;
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.background = type === 'error' ? '#f8d7da' : 
                                          type === 'success' ? '#d4edda' : '#d1ecf1';
            notification.style.color = type === 'error' ? '#721c24' : 
                                      type === 'success' ? '#155724' : '#0c5460';
            notification.style.borderLeft = type === 'error' ? '4px solid #dc3545' : 
                                           type === 'success' ? '4px solid #28a745' : '4px solid #17a2b8';
            
            notification.innerHTML = `
                <span style="font-size: 20px;">${type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è'}</span>
                <span>${message}</span>
                <button onclick="this.parentElement.remove()" style="background:none; border:none; font-size:20px; cursor:pointer; margin-left:auto;">√ó</button>
            `;
            
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 5000);
        }

        // CSS pour l'animation du spinner
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
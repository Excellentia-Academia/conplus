<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excellentia Academia - Éloquence en Scène</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #27ae60;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: var(--primary);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 30px 30px;
            animation: float 20s linear infinite;
        }
        
        @keyframes float {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(-30px, -30px) rotate(360deg); }
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .login-section {
            padding: 40px;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .login-section.active {
            display: block;
        }
        
        .login-box {
            max-width: 400px;
            margin: 0 auto;
            background: var(--light);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3);
        }
        
        .btn {
            display: inline-block;
            padding: 14px 28px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            width: 100%;
        }
        
        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-primary {
            background: var(--primary);
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-danger {
            background: var(--accent);
        }
        
        .dashboard {
            padding: 30px;
            display: none;
        }
        
        .dashboard.active {
            display: block;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--light);
        }
        
        .welcome-message h2 {
            color: var(--primary);
            font-size: 1.8em;
        }
        
        .logout-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--light);
            padding-bottom: 10px;
        }
        
        .tab-btn {
            padding: 12px 24px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s;
        }
        
        .tab-btn:hover {
            background: var(--light);
        }
        
        .tab-btn.active {
            color: var(--primary);
            border-bottom: 3px solid var(--secondary);
            background: rgba(52, 152, 219, 0.1);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--light);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .table-container {
            overflow-x: auto;
            background: var(--light);
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        tr:hover {
            background: rgba(52, 152, 219, 0.05);
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }
        
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .code-display {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 1.2em;
            text-align: center;
            margin: 20px 0;
            border: 2px dashed #dee2e6;
        }
        
        .export-btn {
            margin-top: 20px;
            background: var(--success);
        }
        
        @media (max-width: 768px) {
            .dashboard-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
        }
        
        .payment-status {
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .mobile-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
        }
        
        .mobile-indicator.mobile-no {
            background: #95a5a6;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- En-tête -->
        <div class="header">
            <h1>Excellentia Academia</h1>
            <div class="subtitle">Concours "Éloquence en Scène" - Centre de Contrôle</div>
        </div>
        
        <!-- Section de Connexion -->
        <div class="login-section active" id="loginSection">
            <div class="login-box">
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">Accès Administrateur</h2>
                <div class="form-group">
                    <label for="accessCode">Code d'Accès</label>
                    <input type="password" id="accessCode" class="form-control" placeholder="Entrez le code d'accès">
                </div>
                <button class="btn btn-primary" onclick="login()">Se Connecter</button>
                <div style="margin-top: 20px; text-align: center; color: #666; font-size: 0.9em;">
                    Code requis : Excellentiaacademia05/05/unikin
                </div>
            </div>
        </div>
        
        <!-- Tableau de bord -->
        <div class="dashboard" id="dashboard">
            <div class="dashboard-header">
                <div class="welcome-message">
                    <h2>Centre de Contrôle - Éloquence en Scène</h2>
                    <p>Bienvenue, Coordinateur</p>
                </div>
                <button class="logout-btn" onclick="logout()">Déconnexion</button>
            </div>
            
            <!-- Statistiques -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Participants Totaux</div>
                    <div class="stat-number" id="totalParticipants">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Paiements Confirmés</div>
                    <div class="stat-number" id="confirmedPayments">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Votes Totaux</div>
                    <div class="stat-number" id="totalVotes">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Accès Mobile</div>
                    <div class="stat-number" id="mobileAccess">0</div>
                </div>
            </div>
            
            <!-- Onglets -->
            <div class="tabs">
                <button class="tab-btn active" onclick="openTab('participants')">Participants</button>
                <button class="tab-btn" onclick="openTab('payments')">Paiements</button>
                <button class="tab-btn" onclick="openTab('votes')">Contrôle des Votes</button>
                <button class="tab-btn" onclick="openTab('generator')">Générateur de Codes</button>
            </div>
            
            <!-- Contenu des onglets -->
            
            <!-- Onglet Participants -->
            <div class="tab-content active" id="participantsTab">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>Liste des Participants</h3>
                    <button class="btn btn-primary" onclick="addParticipant()">Ajouter Participant</button>
                </div>
                <div class="table-container">
                    <table id="participantsTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nom Complet</th>
                                <th>Téléphone</th>
                                <th>Email</th>
                                <th>Institution</th>
                                <th>Date Inscription</th>
                                <th>Mobile</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="participantsBody">
                            <!-- Rempli dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Onglet Paiements -->
            <div class="tab-content" id="paymentsTab">
                <h3 style="margin-bottom: 20px;">Statut des Paiements</h3>
                <div class="table-container">
                    <table id="paymentsTable">
                        <thead>
                            <tr>
                                <th>ID Participant</th>
                                <th>Nom</th>
                                <th>Montant</th>
                                <th>Date Paiement</th>
                                <th>Méthode</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="paymentsBody">
                            <!-- Rempli dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Onglet Votes -->
            <div class="tab-content" id="votesTab">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>Contrôle des Votes</h3>
                    <button class="btn btn-success" onclick="exportVotes()">Exporter les Votes</button>
                </div>
                <div class="table-container">
                    <table id="votesTable">
                        <thead>
                            <tr>
                                <th>ID Participant</th>
                                <th>Nom</th>
                                <th>Votes Validés</th>
                                <th>Votes en Attente</th>
                                <th>Total</th>
                                <th>Position</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="votesBody">
                            <!-- Rempli dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Onglet Générateur -->
            <div class="tab-content" id="generatorTab">
                <h3 style="margin-bottom: 20px;">Générateur de Codes d'Accès</h3>
                <div class="form-group">
                    <label for="codeType">Type de Code</label>
                    <select id="codeType" class="form-control">
                        <option value="jury">Code Jury</option>
                        <option value="admin">Code Administrateur</option>
                        <option value="vote">Code Vote Public</option>
                        <option value="participant">Code Participant</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="codeQuantity">Nombre de Codes</label>
                    <input type="number" id="codeQuantity" class="form-control" value="1" min="1" max="100">
                </div>
                <div class="form-group">
                    <label for="codeExpiry">Date d'Expiration</label>
                    <input type="date" id="codeExpiry" class="form-control">
                </div>
                <button class="btn btn-primary" onclick="generateCodes()">Générer Codes</button>
                
                <div id="generatedCodes" style="margin-top: 30px;">
                    <!-- Codes générés s'affichent ici -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal d'ajout de participant -->
    <div class="modal" id="addParticipantModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ajouter un Participant</h3>
                <button class="close-modal" onclick="closeModal()">×</button>
            </div>
            <form id="participantForm" onsubmit="saveParticipant(event)">
                <div class="form-group">
                    <label for="fullName">Nom Complet *</label>
                    <input type="text" id="fullName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="phone">Numéro de Téléphone *</label>
                    <input type="tel" id="phone" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" class="form-control">
                </div>
                <div class="form-group">
                    <label for="institution">Institution</label>
                    <input type="text" id="institution" class="form-control">
                </div>
                <div class="form-group">
                    <label for="mobileAccessSelect">Accès Mobile</label>
                    <select id="mobileAccessSelect" class="form-control">
                        <option value="yes">Oui</option>
                        <option value="no">Non</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="paymentStatus">Statut Paiement</label>
                    <select id="paymentStatus" class="form-control">
                        <option value="pending">En attente</option>
                        <option value="confirmed">Confirmé</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success">Enregistrer</button>
            </form>
        </div>
    </div>

    <script>
        // Données de base pour démo
        const demoParticipants = [
            {
                id: 1,
                name: "Jean Kabasele",
                phone: "+243 81 234 5678",
                email: "jean.k@unikin.ac.cd",
                institution: "Université de Kinshasa",
                date: "2024-05-01",
                mobile: "yes",
                payment: "confirmed",
                amount: 5000,
                paymentDate: "2024-05-02",
                paymentMethod: "Mobile Money",
                votes: 150,
                pendingVotes: 25
            },
            {
                id: 2,
                name: "Marie Luzolo",
                phone: "+243 89 876 5432",
                email: "marie.l@unikin.ac.cd",
                institution: "Université de Kinshasa",
                date: "2024-05-03",
                mobile: "yes",
                payment: "pending",
                amount: 0,
                paymentDate: "",
                paymentMethod: "",
                votes: 89,
                pendingVotes: 15
            },
            {
                id: 3,
                name: "David Mbaya",
                phone: "+243 82 345 6789",
                email: "david.m@unikin.ac.cd",
                institution: "Université de Kinshasa",
                date: "2024-05-04",
                mobile: "no",
                payment: "confirmed",
                amount: 5000,
                paymentDate: "2024-05-04",
                paymentMethod: "Espèces",
                votes: 203,
                pendingVotes: 32
            },
            {
                id: 4,
                name: "Sarah Nkosi",
                phone: "+243 84 567 8901",
                email: "sarah.n@unikin.ac.cd",
                institution: "Université de Kinshasa",
                date: "2024-05-05",
                mobile: "yes",
                payment: "confirmed",
                amount: 5000,
                paymentDate: "2024-05-05",
                paymentMethod: "Mobile Money",
                votes: 167,
                pendingVotes: 28
            }
        ];

        let participants = JSON.parse(localStorage.getItem('excellentia_participants')) || demoParticipants;
        let generatedCodes = JSON.parse(localStorage.getItem('excellentia_codes')) || [];

        // Fonction de connexion
        function login() {
            const accessCode = document.getElementById('accessCode').value;
            const correctCode = "Excellentiaacademia05/05/unikin";
            
            if (accessCode === correctCode) {
                document.getElementById('loginSection').classList.remove('active');
                document.getElementById('dashboard').classList.add('active');
                loadDashboard();
            } else {
                alert("Code d'accès incorrect !");
            }
        }

        // Fonction de déconnexion
        function logout() {
            document.getElementById('loginSection').classList.add('active');
            document.getElementById('dashboard').classList.remove('active');
            document.getElementById('accessCode').value = '';
        }

        // Chargement du tableau de bord
        function loadDashboard() {
            updateStats();
            loadParticipants();
            loadPayments();
            loadVotes();
        }

        // Mise à jour des statistiques
        function updateStats() {
            const total = participants.length;
            const confirmed = participants.filter(p => p.payment === 'confirmed').length;
            const mobile = participants.filter(p => p.mobile === 'yes').length;
            const totalVotes = participants.reduce((sum, p) => sum + p.votes + p.pendingVotes, 0);
            
            document.getElementById('totalParticipants').textContent = total;
            document.getElementById('confirmedPayments').textContent = confirmed;
            document.getElementById('mobileAccess').textContent = mobile;
            document.getElementById('totalVotes').textContent = totalVotes;
        }

        // Chargement des participants
        function loadParticipants() {
            const tbody = document.getElementById('participantsBody');
            tbody.innerHTML = '';
            
            participants.forEach(participant => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${participant.id}</td>
                    <td>${participant.name}</td>
                    <td>${participant.phone}</td>
                    <td>${participant.email || '-'}</td>
                    <td>${participant.institution || '-'}</td>
                    <td>${participant.date}</td>
                    <td>
                        <div class="payment-status">
                            <span class="mobile-indicator ${participant.mobile === 'yes' ? '' : 'mobile-no'}"></span>
                            ${participant.mobile === 'yes' ? 'Oui' : 'Non'}
                        </div>
                    </td>
                    <td>
                        <button class="btn" style="padding: 5px 10px; font-size: 0.9em;" onclick="editParticipant(${participant.id})">Modifier</button>
                        <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.9em;" onclick="deleteParticipant(${participant.id})">Supprimer</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Chargement des paiements
        function loadPayments() {
            const tbody = document.getElementById('paymentsBody');
            tbody.innerHTML = '';
            
            participants.forEach(participant => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${participant.id}</td>
                    <td>${participant.name}</td>
                    <td>${participant.payment === 'confirmed' ? '5 000 CDF' : '-'}</td>
                    <td>${participant.paymentDate || '-'}</td>
                    <td>${participant.paymentMethod || '-'}</td>
                    <td>
                        <span class="badge ${participant.payment === 'confirmed' ? 'badge-success' : 'badge-warning'}">
                            ${participant.payment === 'confirmed' ? 'Confirmé' : 'En attente'}
                        </span>
                    </td>
                    <td>
                        ${participant.payment === 'pending' ? 
                            `<button class="btn btn-success" style="padding: 5px 10px; font-size: 0.9em;" onclick="confirmPayment(${participant.id})">Confirmer Paiement</button>` : 
                            '<button class="btn" style="padding: 5px 10px; font-size: 0.9em;" onclick="undoPayment(${participant.id})">Annuler</button>'}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Chargement des votes
        function loadVotes() {
            const tbody = document.getElementById('votesBody');
            tbody.innerHTML = '';
            
            // Trier par nombre total de votes
            const sortedParticipants = [...participants].sort((a, b) => 
                (b.votes + b.pendingVotes) - (a.votes + a.pendingVotes));
            
            sortedParticipants.forEach((participant, index) => {
                const totalVotes = participant.votes + participant.pendingVotes;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${participant.id}</td>
                    <td>${participant.name}</td>
                    <td>${participant.votes}</td>
                    <td>${participant.pendingVotes}</td>
                    <td><strong>${totalVotes}</strong></td>
                    <td>${index + 1}</td>
                    <td>
                        <button class="btn" style="padding: 5px 10px; font-size: 0.9em;" onclick="addVotes(${participant.id})">Ajouter Votes</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Navigation par onglets
        function openTab(tabName) {
            // Désactiver tous les onglets
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Activer l'onglet sélectionné
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
        }

        // Modal d'ajout de participant
        function addParticipant() {
            document.getElementById('participantForm').reset();
            document.getElementById('addParticipantModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('addParticipantModal').classList.remove('active');
        }

        // Sauvegarde d'un participant
        function saveParticipant(event) {
            event.preventDefault();
            
            const newId = participants.length > 0 ? Math.max(...participants.map(p => p.id)) + 1 : 1;
            const newParticipant = {
                id: newId,
                name: document.getElementById('fullName').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                institution: document.getElementById('institution').value,
                date: new Date().toISOString().split('T')[0],
                mobile: document.getElementById('mobileAccessSelect').value,
                payment: document.getElementById('paymentStatus').value,
                amount: document.getElementById('paymentStatus').value === 'confirmed' ? 5000 : 0,
                paymentDate: document.getElementById('paymentStatus').value === 'confirmed' ? 
                    new Date().toISOString().split('T')[0] : '',
                paymentMethod: document.getElementById('paymentStatus').value === 'confirmed' ? 
                    'Mobile Money' : '',
                votes: 0,
                pendingVotes: 0
            };
            
            participants.push(newParticipant);
            localStorage.setItem('excellentia_participants', JSON.stringify(participants));
            
            loadDashboard();
            closeModal();
            alert("Participant ajouté avec succès !");
        }

        // Modification d'un participant
        function editParticipant(id) {
            const participant = participants.find(p => p.id === id);
            if (participant) {
                document.getElementById('fullName').value = participant.name;
                document.getElementById('phone').value = participant.phone;
                document.getElementById('email').value = participant.email || '';
                document.getElementById('institution').value = participant.institution || '';
                document.getElementById('mobileAccessSelect').value = participant.mobile;
                document.getElementById('paymentStatus').value = participant.payment;
                
                // Remplacer la fonction de sauvegarde pour la modification
                document.getElementById('participantForm').onsubmit = function(e) {
                    e.preventDefault();
                    
                    participant.name = document.getElementById('fullName').value;
                    participant.phone = document.getElementById('phone').value;
                    participant.email = document.getElementById('email').value;
                    participant.institution = document.getElementById('institution').value;
                    participant.mobile = document.getElementById('mobileAccessSelect').value;
                    participant.payment = document.getElementById('paymentStatus').value;
                    
                    if (participant.payment === 'confirmed' && !participant.paymentDate) {
                        participant.paymentDate = new Date().toISOString().split('T')[0];
                        participant.paymentMethod = 'Mobile Money';
                        participant.amount = 5000;
                    }
                    
                    localStorage.setItem('excellentia_participants', JSON.stringify(participants));
                    loadDashboard();
                    closeModal();
                    alert("Participant modifié avec succès !");
                };
                
                document.getElementById('addParticipantModal').classList.add('active');
            }
        }

        // Suppression d'un participant
        function deleteParticipant(id) {
            if (confirm("Voulez-vous vraiment supprimer ce participant ?")) {
                participants = participants.filter(p => p.id !== id);
                localStorage.setItem('excellentia_participants', JSON.stringify(participants));
                loadDashboard();
            }
        }

        // Confirmation de paiement
        function confirmPayment(id) {
            const participant = participants.find(p => p.id === id);
            if (participant) {
                participant.payment = 'confirmed';
                participant.paymentDate = new Date().toISOString().split('T')[0];
                participant.paymentMethod = 'Mobile Money';
                participant.amount = 5000;
                
                localStorage.setItem('excellentia_participants', JSON.stringify(participants));
                loadDashboard();
                alert("Paiement confirmé avec succès !");
            }
        }

        // Annulation de paiement
        function undoPayment(id) {
            const participant = participants.find(p => p.id === id);
            if (participant) {
                participant.payment = 'pending';
                participant.paymentDate = '';
                participant.paymentMethod = '';
                participant.amount = 0;
                
                localStorage.setItem('excellentia_participants', JSON.stringify(participants));
                loadDashboard();
                alert("Paiement annulé !");
            }
        }

        // Ajout de votes
        function addVotes(id) {
            const votes = prompt("Nombre de votes à ajouter :");
            if (votes && !isNaN(votes) && votes > 0) {
                const participant = participants.find(p => p.id === id);
                if (participant) {
                    participant.pendingVotes += parseInt(votes);
                    localStorage.setItem('excellentia_participants', JSON.stringify(participants));
                    loadDashboard();
                    alert(`${votes} votes ajoutés avec succès !`);
                }
            }
        }

        // Génération de codes
        function generateCodes() {
            const type = document.getElementById('codeType').value;
            const quantity = parseInt(document.getElementById('codeQuantity').value);
            const expiry = document.getElementById('codeExpiry').value;
            
            const typeLabels = {
                'jury': 'JURY',
                'admin': 'ADMIN',
                'vote': 'VOTE',
                'participant': 'PART'
            };
            
            const codesDiv = document.getElementById('generatedCodes');
            codesDiv.innerHTML = '<h4>Codes Générés :</h4>';
            
            for (let i = 0; i < quantity; i++) {
                const code = generateRandomCode(typeLabels[type]);
                const codeData = {
                    code: code,
                    type: type,
                    expiry: expiry,
                    used: false,
                    generated: new Date().toISOString()
                };
                
                generatedCodes.push(codeData);
                
                const codeElement = document.createElement('div');
                codeElement.className = 'code-display';
                codeElement.textContent = code;
                codesDiv.appendChild(codeElement);
            }
            
            localStorage.setItem('excellentia_codes', JSON.stringify(generatedCodes));
        }

        // Génération de code aléatoire
        function generateRandomCode(prefix) {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let code = prefix + '-';
            
            for (let i = 0; i < 8; i++) {
                code += chars[Math.floor(Math.random() * chars.length)];
            }
            
            return code;
        }

        // Exportation des votes
        function exportVotes() {
            const data = participants.map(p => ({
                ID: p.id,
                Nom: p.name,
                'Votes Validés': p.votes,
                'Votes En Attente': p.pendingVotes,
                Total: p.votes + p.pendingVotes,
                'Date Inscription': p.date,
                Statut: p.payment === 'confirmed' ? 'Payé' : 'En attente'
            }));
            
            const csv = convertToCSV(data);
            downloadCSV(csv, 'votes_eloquence_scene.csv');
        }

        // Conversion en CSV
        function convertToCSV(data) {
            const headers = Object.keys(data[0]);
            const rows = data.map(row => 
                headers.map(header => JSON.stringify(row[header])).join(',')
            );
            return [headers.join(','), ...rows].join('\n');
        }

        // Téléchargement CSV
        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Chargement initial
        document.addEventListener('DOMContentLoaded', function() {
            // Définir la date d'expiration par défaut à 1 mois
            const defaultDate = new Date();
            defaultDate.setMonth(defaultDate.getMonth() + 1);
            document.getElementById('codeExpiry').value = defaultDate.toISOString().split('T')[0];
        });
    </script>
</body>
</html>